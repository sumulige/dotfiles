# Daily - 每日反馈循环系统

> 项目代号: `daily`
> 目标: 极度完美主义的个人开发反馈循环系统

---

## 核心概念

```
┌─────────────────────────────────────────────────────────────┐
│              反馈循环系统架构                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌─────────┐                             │
│   输入   │    ┌────────┤  数据   │──────┐                │
│          │    │  捕获  │  层     │      │                │
│  ┌─────┐ │    │  Layer │        │      │                │
│  │代码 │─┼──>│        │        │      ▼                │
│  │命令 │─┤   └───────┴────────┘  ┌─────────┐             │
│  │文件 │─│                          │  SQLite │             │
│  │时间 │─┤                          │ Database │             │
│  └─────┘ │                          │  (本地)  │             │
│          │                          └────┬────┘             │
│                    ┌─────────────────────┼────────────┐   │
│                    │                     │            │   │
│                    ▼                     ▼            ▼   │
│             ┌──────────┐         ┌──────────┐  ┌────────┐│
│             │  分析   │         │  可视化  │  │  AI   ││
│             │  Layer  │         │  Layer  │  │ Engine ││
│             └────┬─────┘         └────┬─────┘  └───┬────┘│
│                  │                  │            │      │
│                  ▼                  ▼            ▼      │
│             ┌──────────────────────────────────────┐   │
│             │              输出 Layer               │   │
│             │  · 终端摘要 (zsh 启动时)               │   │
│             │  · TUI 仪表盘 (`daily`)               │   │
│             │  · 每日报告 (推送)                     │   │
│             │  · 长期趋势 (周/月)                   │   │
│             └──────────────────────────────────────┘   │
│                           │                            │
│                           ▼                            │
│             ┌──────────────────────────────┐            │
│             │      反馈 → 新输入 (循环)      │            │
│             │  · 昨天做了什么？              │            │
│             │  · 这意味着什么？              │            │
│             │  · 明天该做什么？              │            │
│             └──────────────────────────────┘            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 技术选型

基于你的环境 (macOS + Zsh + Neovim + Go) 和完美主义要求：

| 组件 | 技术选择 | 理由 |
|------|----------|------|
| **核心语言** | Go | 性能强，TUI 成熟，跨平台编译 |
| **TUI 框架** | Bubbletea | Charmbracelet 出品，设计优秀 |
| **数据库** | SQLite | 本地零配置，SQL 查询能力强 |
| **数据可视化** | bubbletea + bubbles | ASCII 图表，终端原生 |
| **Zsh 集成** | Hook 脚本 | 启动时自动显示摘要 |
| **AI 分析** | Claude API | 可选的深度洞察生成 |

---

## 系统架构

```
daily/
├── cmd/
│   ├── capture/     # 数据捕获 CLI
│   ├── analyze/     # 分析引擎
│   ├── dashboard/   # TUI 仪表盘
│   └── report/      # 报告生成
├── internal/
│   ├── capture/     # 捕获器 (git, atuin, zoxide, fs)
│   ├── storage/     # SQLite 存储层
│   ├── analysis/    # 分析模块
│   ├── ui/          # TUI 组件
│   └── ai/          # AI 洞察引擎
├── zsh/             # Zsh 集成
│   └── daily-hook.zsh
└── README.md
```

---

## 功能设计

### 1. 数据捕获层 (Capture Layer)

| 捕获器 | 数据源 | 频率 |
|--------|--------|------|
| Git 捕获 | commits, branches, files | 每次 commit |
| 命令捕获 | atuin history | 定期同步 |
| 文件捕获 | 文件修改时间, 编辑器事件 | 文件保存时 |
| 项目捕获 | zoxide 数据 | 目录切换时 |
| 时间捕获 | 终端会话时长 | 会话结束 |

### 2. 分析引擎 (Analysis Engine)

```
┌─────────────────────────────────────────────────────────────┐
│                    分析维度                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  时间分析                                                  │
│  · 编码时段分布 (热图)                                      │
│  · 项目时间分配                                            │
│  · 深度工作时段                                            │
│                                                             │
│  产出分析                                                  │
│  · Commits 趋势                                            │
│  · 代码行数变化                                            │
│  · 文件类型分布                                            │
│                                                             │
│  模式分析                                                  │
│  · 最常编辑的文件                                          │
│  · 命令使用频率                                            │
│  · 项目切换模式                                            │
│                                                             │
│  循环分析                                                  │
│  · Input → Output 比率                                     │
│  · 反馈闭环检查                                            │
│  · 未完成任务追踪                                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3. 可视化层 (Visualization Layer)

#### A. 终端启动摘要 (Zsh Greeting)

```
┌─────────────────────────────────────────────────────────────┐
│  📅 2025-01-16  周四  第 16 天                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  昨日完成                                                  │
│  • Neovim 现代化配置 ✅                                   │
│  • Brew 性能优化 (2.9GB) ✅                               │
│  • 8 commits                                             │
│                                                             │
│  今日待办                                                  │
│  • [ ] development/README.md                              │
│  • [ ] dotfiles-usage skill                              │
│                                                             │
│  💡 洞察                                                   │
│  • 本周代码量: +2,847 行 (↑23%)                           │
│  • 最活跃项目: dotfiles (85%)                             │
│  • 模式: 深度集中在 14:00-18:00                           │
│                                                             │
│  [Enter] 打开仪表盘  |  [q] 忽略                          │
└─────────────────────────────────────────────────────────────┘
```

#### B. TUI 仪表盘 (`daily`)

```
┌─────────────────────────────────────────────────────────────┐
│  DAILY  │  概览  │  项目  │  时间  │  模式  │  设置     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  📊 今日                                                  │
│  ┌──────────────────────────────────────────────────┐     │
│  │  Commits: 5  │  文件: 12  │  时间: 4h 23m        │     │
│  │  ████████░░ 85% 目标完成                             │     │
│  └──────────────────────────────────────────────────┘     │
│                                                             │
│  🔥 最近活动                                              │
│  • feat: add Neovim config       (2h ago)               │
│  • fix: lsp compatibility         (4h ago)               │
│  • docs: update README            (6h ago)               │
│                                                             │
│  📁 活跃项目                                              │
│  dotfiles  ████████████ 85%  (32 files)                  │
│  other     ███░░░░░░░░░░░ 15%  (5 files)                   │
│                                                             │
│  📈 本周趋势                                              │
│      50 ┤      ╷                                          │
│      40 ┤     ╱ ╲                                         │
│      30 ┤    ╱   ╲     ╷──╂                              │
│      20 ┤   ╱     ╲   ╱  ╱  ╲                             │
│      10 ┤  ╱       ╲ ╱  ╱    ╲                            │
│       0 └─┴─┴─┴─┴─┴─┴─┴──┴─┴                            │
│        一 二 三 四 五 六 日                                │
│                                                             │
│  [q] 退出  [d] 详情  [r] 报告  [?] 帮助                   │
└─────────────────────────────────────────────────────────────┘
```

#### C. 详细视图

| 视图 | 内容 |
|------|------|
| **时间轴** | 每小时活动，commit 时间点 |
| **项目热图** | GitHub 风格贡献图 |
| **命令统计** | Top 命令，使用频率趋势 |
| **文件列表** | 最常编辑的文件 |
| **反馈循环** | Input → Output 可视化 |

### 4. AI 洞察引擎 (可选)

基于 Claude API，提供深度分析：

- **模式识别**: "你倾向于在下午 2-5 点做深度工作"
- **效率建议**: "周五的代码质量最高，建议在那时做关键决策"
- **瓶颈发现**: "切换项目后平均需要 15 分钟重新进入状态"
- **成长追踪**: "相比上周，代码行数增加 23%"

---

## 交互设计

### 快捷键 (TUI)

| 按键 | 功能 |
|------|------|
| `q` / `ESC` | 退出 |
| `Tab` | 切换视图 |
| `Enter` | 钻取详情 |
| `?` | 帮助 |
| `d` | 日期选择 |
| `p` | 项目筛选 |
| `/` | 搜索 |
| `r` | 生成报告 |

### 命令行

```bash
daily               # 打开仪表盘
daily today         # 今日摘要
daily week          # 本周概览
daily report        # 生成报告
daily capture       # 手动捕获数据
daily insights      # AI 洞察
daily --export json  # 导出数据
```

---

## 每日报告推送

### 推送渠道设计

由于不使用第三方服务，设计本地推送方案：

**方案 A: 终端通知 (macOS)**
```bash
# 使用 osascript
osascript -e 'display notification "Daily Report" with title "今日完成 8 commits"'
```

**方案 B: 钩子集成**
- Zsh 退出时显示摘要
- 每天 18:00 自动提醒（如果终端活跃）

**方案 C: 报告文件**
```bash
~/DailyReports/2025-01-16.md
# 使用现有 markdown 文件，可被其他工具读取
```

**方案 D: 邮件推送 (可选)**
```bash
# 使用 msmtp + 本地 MTA
# 或使用 API (自托管服务)
```

---

## 数据模型

```sql
-- 项目表
CREATE TABLE projects (
    id INTEGER PRIMARY KEY,
    path TEXT UNIQUE,
    name TEXT,
    created_at TIMESTAMP
);

-- 会话表
CREATE TABLE sessions (
    id INTEGER PRIMARY KEY,
    project_id INTEGER,
    start_at TIMESTAMP,
    end_at TIMESTAMP,
    duration INTEGER
);

-- 事件表
CREATE TABLE events (
    id INTEGER PRIMARY KEY,
    session_id INTEGER,
    type TEXT,  -- 'commit', 'file_edit', 'command'
    data JSON,
    created_at TIMESTAMP
);

-- 反馈循环表
CREATE TABLE feedback_loops (
    id INTEGER PRIMARY KEY,
    date DATE,
    input_summary TEXT,
    output_summary TEXT,
    insights TEXT,
    next_tasks TEXT
);
```

---

## 实现计划

### Phase 1: MVP (最小可用版本)
- [ ] 数据捕获 (Git + 文件系统)
- [ ] SQLite 存储
- [ ] 终端摘要显示
- [ ] 基础 TUI (概览视图)

### Phase 2: 核心功能
- [ ] 完整捕获层 (atuin + zoxide 集成)
- [ ] 分析引擎 (时间 + 产出 + 模式)
- [ ] TUI 所有视图
- [ ] 报告生成

### Phase 3: 高级功能
- [ ] AI 洞察引擎
- [ ] 反馈循环追踪
- [ ] 趋势预测
- [ ] 数据导出/同步

### Phase 4: 体验优化
- [ ] 动画和过渡效果
- [ ] 自定义主题
- [ ] 插件系统
- [ ] Web 仪表盘 (未来)

---

## 设计原则

1. **极简但完整** - 一眼看懂，深入可用
2. **零干扰** - 数据采集后台进行
3. **本地优先** - 所有数据本地存储
4. **渐进增强** - 从简单开始，逐步添加
5. **视觉记忆** - 独特设计，让人记住

---

**创建时间**: 2025-01-16
**状态**: ⏳ 待批准
**预计耗时**: Phase 1 (1周), Phase 2 (2周), Phase 3 (1周), Phase 4 (1周)
