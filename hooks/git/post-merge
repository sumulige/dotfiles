#!/bin/bash
# ============================================
# post-merge hook - git pull åè‡ªåŠ¨åŒæ­¥é…ç½®
# ============================================
# å½“æ‰§è¡Œ git pull æˆåŠŸåè‡ªåŠ¨è§¦å‘

# è·å– dotfiles ç›®å½•
DOTFILES_DIR="$(git rev-parse --show-toplevel)"

# æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®æ–‡ä»¶å˜æ›´
CHANGED_FILES=$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)

# éœ€è¦è§¦å‘åŒæ­¥çš„æ–‡ä»¶æ¨¡å¼
SYNC_PATTERNS=(
    "zsh/"
    "git/"
    "nvim/"
    "ghostty/"
    "iterm2/"
    "starship/"
    "atuin/"
    "sync.sh"
)

should_sync=false

for pattern in "${SYNC_PATTERNS[@]}"; do
    if echo "$CHANGED_FILES" | grep -q "^$pattern"; then
        should_sync=true
        break
    fi
done

if $should_sync; then
    echo ""
    echo "ğŸ”„ æ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å˜æ›´ï¼Œè‡ªåŠ¨åŒæ­¥ä¸­..."
    "$DOTFILES_DIR/sync.sh" --quiet
    echo "âœ… é…ç½®åŒæ­¥å®Œæˆ"
    echo ""
fi
